define(['knockout', 'text!/components/chartViews/costs.html'],
  function(ko, html) {
  'use strict';

  var ViewModel = function(args) {
    var self = this;

    self.comparisonChartsEnabled = ko.observable(false);

    self.tabs = args.charts;
    self.contextTab = self.tabs[0];
    self.comparedTab = self.tabs[1];
    self.data = args.data;

    self.examples = args.Pathway.examples();

    // Selected example same for all tabs
    self.selectedExample = ko.observable();
    // Observable chart data
    self.comparisonData = ko.observable({"EnergyDemandChart":{"chartLayers":[{"key":"Transport","date":2010,"value":688.2438226754279,"y0":1115.263231855837,"y":688.2438226754279},{"key":"Transport","date":2015,"value":667.4436005416428,"y0":1039.1810407712696,"y":667.4436005416428},{"key":"Transport","date":2020,"value":640.3249748337515,"y0":977.0222000382975,"y":640.3249748337515},{"key":"Transport","date":2025,"value":570.313412748504,"y0":923.8705277402601,"y":570.313412748504},{"key":"Transport","date":2030,"value":510.90194042875083,"y0":873.4036076758323,"y":510.90194042875083},{"key":"Transport","date":2035,"value":515.6937287542479,"y0":830.4665214791964,"y":515.6937287542479},{"key":"Transport","date":2040,"value":513.6713260780234,"y0":791.1374032557981,"y":513.6713260780234},{"key":"Transport","date":2045,"value":506.93997574435093,"y0":757.1648723746164,"y":506.93997574435093},{"key":"Transport","date":2050,"value":494.51949211813815,"y0":726.520987970964,"y":494.51949211813815},{"key":"Industry","date":2010,"value":464.1712644571234,"y0":651.0919673987135,"y":464.1712644571234},{"key":"Industry","date":2015,"value":438.8299667118649,"y0":600.3510740594047,"y":438.8299667118649},{"key":"Industry","date":2020,"value":415.09110304187755,"y0":561.9310969964199,"y":415.09110304187755},{"key":"Industry","date":2025,"value":394.2741070477145,"y0":529.5964206925455,"y":394.2741070477145},{"key":"Industry","date":2030,"value":375.3559297978936,"y0":498.0476778779387,"y":375.3559297978936},{"key":"Industry","date":2035,"value":359.11018340859675,"y0":471.35633807059963,"y":359.11018340859675},{"key":"Industry","date":2040,"value":344.5484596242962,"y0":446.5889436315018,"y":344.5484596242962},{"key":"Industry","date":2045,"value":331.3928463077884,"y0":425.77202606682806,"y":331.3928463077884},{"key":"Industry","date":2050,"value":319.42124581079986,"y0":407.09974216016417,"y":319.42124581079986},{"key":"Heating and cooling","date":2010,"value":493.3089237123012,"y0":157.78304368641224,"y":493.3089237123012},{"key":"Heating and cooling","date":2015,"value":451.40121728358844,"y0":148.94985677581624,"y":451.40121728358844},{"key":"Heating and cooling","date":2020,"value":420.88491508242464,"y0":141.04618191399533,"y":420.88491508242464},{"key":"Heating and cooling","date":2025,"value":395.61596709667117,"y0":133.98045359587437,"y":395.61596709667117},{"key":"Heating and cooling","date":2030,"value":370.3769849258119,"y0":127.67069295212684,"y":370.3769849258119},{"key":"Heating and cooling","date":2035,"value":349.17906050071747,"y0":122.17727756988216,"y":349.17906050071747},{"key":"Heating and cooling","date":2040,"value":329.3983981346563,"y0":117.19054549684553,"y":329.3983981346563},{"key":"Heating and cooling","date":2045,"value":312.99541916388614,"y0":112.77660690294192,"y":312.99541916388614},{"key":"Heating and cooling","date":2050,"value":298.2113337812209,"y0":108.88840837894328,"y":298.2113337812209},{"key":"Lighting & appliances","date":2010,"value":157.78304368641224,"y0":0,"y":157.78304368641224},{"key":"Lighting & appliances","date":2015,"value":148.94985677581624,"y0":0,"y":148.94985677581624},{"key":"Lighting & appliances","date":2020,"value":141.04618191399533,"y0":0,"y":141.04618191399533},{"key":"Lighting & appliances","date":2025,"value":133.98045359587437,"y0":0,"y":133.98045359587437},{"key":"Lighting & appliances","date":2030,"value":127.67069295212684,"y0":0,"y":127.67069295212684},{"key":"Lighting & appliances","date":2035,"value":122.17727756988216,"y0":0,"y":122.17727756988216},{"key":"Lighting & appliances","date":2040,"value":117.19054549684553,"y0":0,"y":117.19054549684553},{"key":"Lighting & appliances","date":2045,"value":112.77660690294192,"y0":0,"y":112.77660690294192},{"key":"Lighting & appliances","date":2050,"value":108.88840837894328,"y0":0,"y":108.88840837894328},{"key":"Food consumption [UNUSED]","date":2010,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2015,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2020,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2025,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2030,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2035,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2040,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2045,"value":0,"y0":0,"y":0},{"key":"Food consumption [UNUSED]","date":2050,"value":0,"y0":0,"y":0}],"chartLine":[{"date":2010,"value":2445.0375350208424},{"date":2015,"value":2310.184432767223},{"date":2020,"value":2182.4333278184495},{"date":2025,"value":2022.2056003971175},{"date":2030,"value":1921.041136999376},{"date":2035,"value":1910.765106908665},{"date":2040,"value":1915.6433494813778},{"date":2045,"value":1953.4461199347998},{"date":2050,"value":2019.580825815582}]},"EnergySupplyChart":{"chartLayers":[{"key":"Nuclear fission","date":2010,"value":160.70999999999998,"y0":2284.3275350208423,"y":160.70999999999998},{"key":"Nuclear fission","date":2015,"value":134.9964,"y0":2175.1880327672234,"y":134.9964},{"key":"Nuclear fission","date":2020,"value":131.99648000000002,"y0":2048.3797049613067,"y":131.99648000000002},{"key":"Nuclear fission","date":2025,"value":183.42368000000005,"y0":1833.810491825689,"y":183.42368000000005},{"key":"Nuclear fission","date":2030,"value":286.27808000000005,"y0":1626.8773427136618,"y":286.27808000000005},{"key":"Nuclear fission","date":2035,"value":363.4188800000001,"y0":1535.346226908665,"y":363.4188800000001},{"key":"Nuclear fission","date":2040,"value":466.27328000000006,"y0":1433.255783767092,"y":466.27328000000006},{"key":"Nuclear fission","date":2045,"value":569.1276800000002,"y0":1393.886944696716,"y":569.1276800000002},{"key":"Nuclear fission","date":2050,"value":671.9820800000002,"y0":1412.8924502317368,"y":671.9820800000002},{"key":"Solar","date":2010,"value":0.9334799238139536,"y0":5.329728000000001,"y":0.9334799238139536},{"key":"Solar","date":2015,"value":2.5672344078139533,"y0":5.526302547945205,"y":2.5672344078139533},{"key":"Solar","date":2020,"value":4.373506625860466,"y0":5.8212777808219185,"y":4.373506625860466},{"key":"Solar","date":2025,"value":6.344229819348837,"y0":6.142217452054795,"y":6.344229819348837},{"key":"Solar","date":2030,"value":8.444343250046511,"y0":6.62159890410959,"y":8.444343250046511},{"key":"Solar","date":2035,"value":10.80445693148711,"y0":9.081502616438359,"y":10.80445693148711},{"key":"Solar","date":2040,"value":13.383377253162982,"y0":13.125824136986296,"y":13.383377253162982},{"key":"Solar","date":2045,"value":16.197285815134943,"y0":21.289631958904113,"y":16.197285815134943},{"key":"Solar","date":2050,"value":19.263445725529127,"y0":25.17551169863013,"y":19.263445725529127},{"key":"Wind","date":2010,"value":14.795693100000001,"y0":934.6686908717826,"y":14.795693100000001},{"key":"Wind","date":2015,"value":34.5472443,"y0":849.0382850274004,"y":34.5472443},{"key":"Wind","date":2020,"value":58.642488756000006,"y0":755.3936094520988,"y":58.642488756000006},{"key":"Wind","date":2025,"value":87.18961644000001,"y0":689.6776221675223,"y":87.18961644000001},{"key":"Wind","date":2030,"value":100.00322928,"y0":587.5193972254212,"y":100.00322928},{"key":"Wind","date":2035,"value":102.08462832000002,"y0":435.0434664680678,"y":102.08462832000002},{"key":"Wind","date":2040,"value":97.45618032000002,"y0":265.19359351215166,"y":97.45618032000002},{"key":"Wind","date":2045,"value":86.87123532000001,"y0":189.39721594094706,"y":86.87123532000001},{"key":"Wind","date":2050,"value":86.87123532000001,"y0":154.3723697997233,"y":86.87123532000001},{"key":"Tidal","date":2010,"value":0.0050034246575342495,"y0":6.263207923813955,"y":0.0050034246575342495},{"key":"Tidal","date":2015,"value":0.051702054794520634,"y0":8.09353695575916,"y":0.051702054794520634},{"key":"Tidal","date":2020,"value":1.2076639342465756,"y0":10.194784406682384,"y":1.2076639342465756},{"key":"Tidal","date":2025,"value":1.5787512630136995,"y0":12.486447271403632,"y":1.5787512630136995},{"key":"Tidal","date":2030,"value":5.955609726027396,"y0":15.065942154156101,"y":5.955609726027396},{"key":"Tidal","date":2035,"value":7.998674794520549,"y0":19.885959547925466,"y":7.998674794520549},{"key":"Tidal","date":2040,"value":21.26119316027397,"y0":26.50920139014928,"y":21.26119316027397},{"key":"Tidal","date":2045,"value":29.12490891369863,"y0":37.48691777403906,"y":29.12490891369863},{"key":"Tidal","date":2050,"value":32.7273746671233,"y0":44.438957424159256,"y":32.7273746671233},{"key":"Wave","date":2010,"value":0,"y0":5.329728000000001,"y":0},{"key":"Wave","date":2015,"value":0.030020547945205478,"y0":5.496282,"y":0.030020547945205478},{"key":"Wave","date":2020,"value":0.1584417808219177,"y0":5.662836,"y":0.1584417808219177},{"key":"Wave","date":2025,"value":0.39610445205479383,"y0":5.746113000000001,"y":0.39610445205479383},{"key":"Wave","date":2030,"value":0.7922089041095896,"y0":5.829390000000001,"y":0.7922089041095896},{"key":"Wave","date":2035,"value":3.168835616438358,"y0":5.912667,"y":3.168835616438358},{"key":"Wave","date":2040,"value":7.129880136986295,"y0":5.995944000000001,"y":7.129880136986295},{"key":"Wave","date":2045,"value":15.210410958904115,"y0":6.0792209999999995,"y":15.210410958904115},{"key":"Wave","date":2050,"value":19.01301369863013,"y0":6.162498000000001,"y":19.01301369863013},{"key":"Geothermal","date":2010,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2015,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2020,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2025,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2030,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2035,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2040,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2045,"value":0,"y0":0,"y":0},{"key":"Geothermal","date":2050,"value":0,"y0":0,"y":0},{"key":"Hydro","date":2010,"value":5.329728000000001,"y0":0,"y":5.329728000000001},{"key":"Hydro","date":2015,"value":5.496282,"y0":0,"y":5.496282},{"key":"Hydro","date":2020,"value":5.662836,"y0":0,"y":5.662836},{"key":"Hydro","date":2025,"value":5.746113000000001,"y0":0,"y":5.746113000000001},{"key":"Hydro","date":2030,"value":5.829390000000001,"y0":0,"y":5.829390000000001},{"key":"Hydro","date":2035,"value":5.912667,"y0":0,"y":5.912667},{"key":"Hydro","date":2040,"value":5.995944000000001,"y0":0,"y":5.995944000000001},{"key":"Hydro","date":2045,"value":6.0792209999999995,"y0":0,"y":6.0792209999999995},{"key":"Hydro","date":2050,"value":6.162498000000001,"y0":0,"y":6.162498000000001},{"key":"Environmental heat","date":2010,"value":0,"y0":949.4643839717826,"y":0},{"key":"Environmental heat","date":2015,"value":0,"y0":883.5855293274004,"y":0},{"key":"Environmental heat","date":2020,"value":26.043692649987292,"y0":814.0360982080988,"y":26.043692649987292},{"key":"Environmental heat","date":2025,"value":49.36724053069869,"y0":776.8672386075223,"y":49.36724053069869},{"key":"Environmental heat","date":2030,"value":69.72969239912725,"y0":687.5226265054213,"y":69.72969239912725},{"key":"Environmental heat","date":2035,"value":88.04893373300338,"y0":537.1280947880678,"y":88.04893373300338},{"key":"Environmental heat","date":2040,"value":104.02262443207097,"y0":362.6497738321517,"y":104.02262443207097},{"key":"Environmental heat","date":2045,"value":118.7308299154023,"y0":276.2684512609471,"y":118.7308299154023},{"key":"Environmental heat","date":2050,"value":131.7571335356411,"y0":241.2436051197233,"y":131.7571335356411},{"key":"Bioenergy","date":2010,"value":59.81391124130582,"y0":2224.5136237795364,"y":59.81391124130582},{"key":"Bioenergy","date":2015,"value":110.92272454912273,"y0":2064.2653082181005,"y":110.92272454912273},{"key":"Bioenergy","date":2020,"value":187.31156392820012,"y0":1861.0681410331067,"y":187.31156392820012},{"key":"Bioenergy","date":2025,"value":245.90248789220368,"y0":1587.9080039334854,"y":245.90248789220368},{"key":"Bioenergy","date":2030,"value":282.56375559543125,"y0":1344.3135871182305,"y":282.56375559543125},{"key":"Bioenergy","date":2035,"value":317.92436208810426,"y0":1217.4218648205606,"y":317.92436208810426},{"key":"Bioenergy","date":2040,"value":356.823146479697,"y0":1076.432637287395,"y":356.823146479697},{"key":"Bioenergy","date":2045,"value":398.5981905958108,"y0":995.2887541009052,"y":398.5981905958108},{"key":"Bioenergy","date":2050,"value":440.5780038670613,"y0":972.3144463646755,"y":440.5780038670613},{"key":"Coal","date":2010,"value":435.9410639769615,"y0":949.4643839717826,"y":435.9410639769615},{"key":"Coal","date":2015,"value":393.2975268887698,"y0":883.5855293274004,"y":393.2975268887698},{"key":"Coal","date":2020,"value":282.35413705218195,"y0":840.0797908580861,"y":282.35413705218195},{"key":"Coal","date":2025,"value":131.35723780061605,"y0":826.234479138221,"y":131.35723780061605},{"key":"Coal","date":2030,"value":49.13682644762784,"y0":757.2523189045485,"y":49.13682644762784},{"key":"Coal","date":2035,"value":72.95197117249288,"y0":625.1770285210712,"y":72.95197117249288},{"key":"Coal","date":2040,"value":115.75961244513003,"y0":466.6723982642227,"y":115.75961244513003},{"key":"Coal","date":2045,"value":139.41088186078287,"y0":394.99928117634937,"y":139.41088186078287},{"key":"Coal","date":2050,"value":177.63118132211193,"y0":373.0007386553644,"y":177.63118132211193},{"key":"Oil","date":2010,"value":839.1081758307922,"y0":1385.405447948744,"y":839.1081758307922},{"key":"Oil","date":2015,"value":787.38225200193,"y0":1276.8830562161702,"y":787.38225200193},{"key":"Oil","date":2020,"value":738.6342131228386,"y0":1122.433927910268,"y":738.6342131228386},{"key":"Oil","date":2025,"value":630.3162869946482,"y0":957.5917169388371,"y":630.3162869946482},{"key":"Oil","date":2030,"value":537.9244417660542,"y0":806.3891453521763,"y":537.9244417660542},{"key":"Oil","date":2035,"value":519.2928651269966,"y0":698.1289996935641,"y":519.2928651269966},{"key":"Oil","date":2040,"value":494.0006265780422,"y0":582.4320107093528,"y":494.0006265780422},{"key":"Oil","date":2045,"value":460.878591063773,"y0":534.4101630371322,"y":460.878591063773},{"key":"Oil","date":2050,"value":421.68252638719923,"y0":550.6319199774763,"y":421.68252638719923},{"key":"Natural gas","date":2010,"value":928.4004795233111,"y0":6.268211348471489,"y":928.4004795233111},{"key":"Natural gas","date":2015,"value":840.8930460168467,"y0":8.14523901055368,"y":840.8930460168467},{"key":"Natural gas","date":2020,"value":743.9911611111698,"y0":11.40244834092896,"y":743.9911611111698},{"key":"Natural gas","date":2025,"value":675.612423633105,"y0":14.065198534417332,"y":675.612423633105},{"key":"Natural gas","date":2030,"value":566.4978453452377,"y0":21.021551880183498,"y":566.4978453452377},{"key":"Natural gas","date":2035,"value":407.15883212562176,"y0":27.884634342446017,"y":407.15883212562176},{"key":"Natural gas","date":2040,"value":217.4231989617284,"y0":47.77039455042325,"y":217.4231989617284},{"key":"Natural gas","date":2045,"value":122.78538925320937,"y0":66.61182668773769,"y":122.78538925320937},{"key":"Natural gas","date":2050,"value":77.20603770844075,"y0":77.16633209128256,"y":77.20603770844075}],"chartLine":[{"date":2010,"value":1803.5070545312644},{"date":2015,"value":1706.6246413129124},{"date":2020,"value":1617.347174872049},{"date":2025,"value":1494.183940488764},{"date":2030,"value":1384.305548104583},{"date":2035,"value":1346.1602502334442},{"date":2040,"value":1304.8087293338212},{"date":2045,"value":1264.1048481189675},{"date":2050,"value":1221.0404800891022}]},"CostsContextChart":4724.347173932092,"CostsComparedChart":[{"key":"Other","value":13.027777061036907},{"key":"Industry","value":146.36417676897702},{"key":"Electricity","value":231.03116696769703},{"key":"Bioenergy","value":286.7635003496912},{"key":"Fossil fuels","value":557.0586958858194},{"key":"Buildings","value":732.5757800848759},{"key":"Finance","value":746.5809005275052},{"key":"Transport","value":2010.9451762864876}],"CostsSensitivityChart":4724.347173932092});

    // Update comparison charts
    ko.computed(function() {

      args.DataRequester.pathway(self.selectedExample(), function(data) {
        var data = JSON.parse(data.response)

        // Only parse data for charts in this chart view
        var contextData = args.ChartParser.costsContext(data.cost_components)
        var comparedData = args.ChartParser.costsCompared(data.cost_components)

        self.comparisonData({
          CostsContextChart: contextData,
          CostsComparedChart: comparedData,
          CostsSensitivityChart: comparedData
        });
      });
    });


    self.currentTabId = ko.observable(1);

    /** Sets visible tab */
    self.setActiveTab = function(chart) {
      self.currentTabId(chart.id);
    };

    self.enableComparisonCharts = function() {
      if(self.selectedExample()) {
        self.comparisonChartsEnabled(true);
      }
    }
  };

  return {
    viewModel: ViewModel,
    template: html
  };

});

